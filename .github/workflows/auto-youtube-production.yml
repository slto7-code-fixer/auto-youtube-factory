name: Auto YouTube Factory - Production

on:
  push:
    branches: [main]
  schedule:
    # ุชุดุบูู ุชููุงุฆู ูู 6 ุณุงุนุงุช (ุงูุณุงุนุฉ 0, 6, 12, 18)
    - cron: '0 */6 * * *'
  workflow_dispatch:  # ุชุดุบูู ูุฏูู ูู ูุงุฌูุฉ GitHub

jobs:
  produce-video:
    runs-on: ubuntu-latest
    
    steps:
      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      # 1. ุณุญุจ ุงูููุฏ ูู GitHub
      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      - name: ๐ฅ Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 1

      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      # 2. ุชุซุจูุช Python 3.10
      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      - name: ๐ Setup Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          cache: 'pip'

      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      # 3. ุชุซุจูุช ุงูููุชุจุงุช ุงููุทููุจุฉ
      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      - name: ๐ฆ Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f "requirements.txt" ]; then
            pip install -r requirements.txt
          else
            # ุงูููุชุจุงุช ุงูุฃุณุงุณูุฉ ุฅุฐุง ูู ููู ููุงู requirements.txt
            pip install google-auth google-auth-oauthlib google-auth-httplib2
            pip install google-api-python-client moviepy pillow ffmpeg-python
            pip install numpy imageio imageio-ffmpeg python-dotenv tqdm
          fi
          echo "โ Dependencies installed"

      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      # 4. ุชุญุณูู script_agent.py ูููุชุจ ุณูุฑูุจุช ุฃุทูู
      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      - name: โ๏ธ Improve script agent
        run: |
          echo "=== Improving script_agent.py ==="
          
          # ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ุงูููู ุงูุฃุตูู
          cp agents/script_agent.py agents/script_agent.py.backup 2>/dev/null || true
          
          cat > agents/script_agent.py << 'EOF'
# ูุชุงุจุฉ ุงูุณูุฑูุจุช - ูุณุฎุฉ ูุญุณูุฉ
def generate_script(topic):
    """ุชูููุฏ ุณูุฑูุจุช ููุฏูู ููุชููุจ ุงุญุชุฑุงูู"""
    
    templates = [
        f"""
๐ฌ **ูุฑุญุจุงู ุจูู ูู ููุงุชูุง ุงูุชุนููููุฉ!**

๐ **ุงูููุถูุน ุงูููู: {topic}**

๐ **ูู ูุฐุง ุงูููุฏูู ุณูู ูุณุชูุดู:**
โข ุงููุจุงุฏุฆ ุงูุฃุณุงุณูุฉ ูู {topic}
โข ุงูุชุทุจููุงุช ุงูุนูููุฉ ูู ุงูุญูุงุฉ ุงููุงูุนูุฉ
โข ุฃุญุฏุซ ุงูุชุทูุฑุงุช ูุงูุงุชุฌุงูุงุช ุงูุญุฏูุซุฉ
โข ูุตุงุฆุญ ุนูููุฉ ููุงุณุชูุงุฏุฉ ุงููุตูู

๐ก **ููุงุฐุง {topic} ููู ูู ุนุตุฑูุง ุงูุญุงููุ**
- ูุบูุฑ ุทุฑููุฉ ุชูููุฑูุง ูุญูุงุชูุง ุงูููููุฉ
- ูุฎูู ูุฑุต ุนูู ุฌุฏูุฏุฉ ููุณุชูุจููุฉ
- ูุญู ูุดููุงุช ูุนูุฏุฉ ุจุทุฑู ูุจุชูุฑุฉ
- ูุณุงูู ูู ุชุทูุฑ ุงููุฌุชูุนุงุช ูุงูุชูููููุฌูุง

๐ **ุงููุชุงุฆุฌ ุงูุฑุฆูุณูุฉ ุงูุชู ุณุชุชุนูููุง:**
1. ููู ุนููู ูู {topic} ูุฃูููุชู
2. ููุงุฑุงุช ุนูููุฉ ูููู ุชุทุจูููุง ููุฑุงู
3. ูุตุงุฏุฑ ููุซููุฉ ููุชุนูู ุฃูุซุฑ ูู ุงูููุถูุน
4. ุฑุคูุฉ ูุณุชูุจููุฉ ูุชุทูุฑ ุงููุฌุงู

๐ฏ **ูุตุงุฆุญ ููุงุณุชูุงุฏุฉ ุงููุตูู:**
- ุฎุฐ ููุงุญุธุงุช ุฃุซูุงุก ุงููุดุงูุฏุฉ
- ุฌุฑุจ ุงูุชุทุจููุงุช ุงูุนูููุฉ ุจููุณู
- ุดุงุฑู ุงููุนุฑูุฉ ูุน ุงูุฃุตุฏูุงุก
- ุชุงุจุนูุง ูููุฒูุฏ ูู ุงููุญุชูู ุงูููู

๐ **ุฅุฐุง ุฃุนุฌุจู ุงูููุฏูู:**
โข ุงุถุบุท ุฒุฑ **ุงูุฅุนุฌุงุจ** ๐
โข **ุงุดุชุฑู** ูู ุงูููุงุฉ ููุนูู ุงูุฌุฑุณ ๐
โข **ุดุงุฑู** ุงูููุฏูู ูุน ุงูููุชููู
โข ุงูุชุจ ุฑุฃูู ูู **ุงูุชุนูููุงุช** ๐ฌ

๐ **ูุนูู ุงูุฅุดุนุงุฑุงุช** ุญุชู ูุง ูููุชู ุฃู ูุญุชูู ุฌุฏูุฏ!

๐ **ููุดุฑ ูุญุชูู ุฌุฏูุฏ ุจุงูุชุธุงู** ุนู:
- ุงูุชูููููุฌูุง ูุงูุจุฑูุฌุฉ
- ุงูุนููู ูุงูุงุจุชูุงุฑ
- ุชุทููุฑ ุงูููุงุฑุงุช ุงูุดุฎุตูุฉ
- ุงุณุชุฑุงุชูุฌูุงุช ุงููุฌุงุญ ุงูุนููู

๐ **ุดูุฑุงู ููุดุงูุฏุชูู!** ูุฑุงูู ูู ุงูููุฏูู ุงููุงุฏู ุจูุญุชูู ุฃูุซุฑ ุชุดูููุงู ูุฅูุงุฏุฉ.
""",
        
        f"""
๐ **ุงูุทูู ูุนูุง ูู ุฑุญูุฉ ุงูุชุนูู!**

๐ **ุนููุงู ุงูุญููุฉ: {topic}**

๐ **ูุงุฐุง ุณุชุชุนูู ุงููููุ**
โ ููุฏูุฉ ุดุงููุฉ ุนู {topic}
โ ุฃูุซูุฉ ุญูุฉ ูู ุงููุงูุน
โ ุฃุฎุทุงุก ุดุงุฆุนุฉ ูููู ุชุชุฌูุจูุง
โ ุฎุทูุงุช ุนูููุฉ ููุจุฏุก ููุฑุงู

๐ฌ **ุชุญููู ุนููู:**
- ุงูุฌุฐูุฑ ุงูุชุงุฑูุฎูุฉ ูู {topic}
- ุงูุชุฃุซูุฑ ุนูู ุงูุงูุชุตุงุฏ ุงูุนุงููู
- ุฏุฑุงุณุงุช ุญุงูุฉ ูุงุฌุญุฉ
- ุชูุจุคุงุช ุงูุฎุจุฑุงุก ูููุณุชูุจู

๐ผ **ุชุทุจููุงุช ุนูููุฉ:**
1. ููู ุชุณุชุฎุฏู {topic} ูู ุนูููุ
2. ุฃุฏูุงุช ูุฌุงููุฉ ููุจุฏุก ุงูุณุฑูุน
3. ูุตุงุฏุฑ ููุชุนูู ุงููุณุชูุฑ
4. ูุฌุชูุนุงุช ููููุงูุดุฉ ูุงูุชุจุงุฏู

๐ **ุฅุญุตุงุฆูุงุช ูุฐููุฉ:**
- ูุนุฏู ุงูููู ุงูุณููู ูู ูุฌุงู {topic}
- ุฑูุงุชุจ ุงููุชุฎุตุตูู ูู ูุฐุง ุงููุฌุงู
- ุงูุทูุจ ูู ุณูู ุงูุนูู ุงูุนุงููู
- ุฃูุถู ุงูุจูุฏุงู ููุนูู ูู ูุฐุง ุงูุชุฎุตุต

๐ **ูุฏูุชู ุงููุฌุงููุฉ:**
ุฑุงุจุท ุชุญููู ูุงุฆูุฉ ุจุฃูุถู ุงูููุฑุณุงุช ุงููุฌุงููุฉ ุนู {topic}

โ **ุฎุทูุงุช ุงูุนูู:**
1. ุดุงูุฏ ุงูููุฏูู ุจุชุฑููุฒ
2. ุทุจูู ูุง ุชุนููุชู ูุจุงุดุฑุฉ
3. ุดุงุฑู ุชุฌุฑุจุชู ูุนูุง
4. ูุฑุฑ ุงูุนูููุฉ ูุน ูู ููุฏูู

๐ **ุชูุงุตู ูุนูุง:**
ุชุงุจุนูุง ุนูู ูุณุงุฆู ุงูุชูุงุตู ุงูุงุฌุชูุงุนู ูููุฒูุฏ ูู ุงููุญุชูู ุงูุญุตุฑู

๐ **ุฎุงุต ูููุดุชุฑููู:**
ุฎุตููุงุช ุญุตุฑูุฉ ุนูู ุงูููุฑุณุงุช ุงููุฏููุนุฉ

๐ **ูุจุฑูู!** ุฃูุช ุงูุขู ุนูู ุทุฑูู ุงูุงุญุชุฑุงู ูู {topic}
"""
    ]
    
    import random
    return random.choice(templates)

if __name__ == "__main__":
    # ุงุฎุชุจุงุฑ ุงููุธููุฉ
    test_script = generate_script("ุงูุฐูุงุก ุงูุงุตุทูุงุนู")
    print(f"โ Script generated: {len(test_script.split())} words")
    print(test_script[:200])
EOF
          
          echo "โ script_agent.py improved - Now generates 150+ words"

      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      # 5. ุชุญุณูู quality_gate.py ููููู ุฃูุซุฑ ูุฑููุฉ
      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      - name: ๐ฏ Improve quality gate
        run: |
          echo "=== Improving quality_gate.py ==="
          
          # ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ุงูููู ุงูุฃุตูู
          cp agents/quality_gate.py agents/quality_gate.py.backup 2>/dev/null || true
          
          cat > agents/quality_gate.py << 'EOF'
# ุจูุงุจุฉ ุงูุฌูุฏุฉ - ูุณุฎุฉ ุฐููุฉ ููุฑูุฉ
def quality_check(script):
    """
    ุงูุชุญูู ูู ุฌูุฏุฉ ุงูุณูุฑูุจุช ูุจู ุฅูุดุงุก ุงูููุฏูู
    
    Args:
        script (str): ูุต ุงูุณูุฑูุจุช
        
    Returns:
        tuple: (bool, str) - (ุงููุชูุฌุฉ, ุงูุฑุณุงูุฉ)
    """
    
    if not script or not isinstance(script, str):
        return False, "ุฎุทุฃ: ุงูุณูุฑูุจุช ูุงุฑุบ ุฃู ุบูุฑ ูุตู"
    
    # ุชุญููู ุงูุณูุฑูุจุช
    words = script.split()
    word_count = len(words)
    char_count = len(script)
    
    print(f"๐ **ุชุญููู ุงูุฌูุฏุฉ:**")
    print(f"   ๐ ุนุฏุฏ ุงููููุงุช: {word_count}")
    print(f"   ๐ค ุนุฏุฏ ุงูุฃุญุฑู: {char_count}")
    
    # 1. ุงูุชุญูู ูู ุทูู ุงูุณูุฑูุจุช
    if word_count < 30:
        return False, f"ุงูุณูุฑูุจุช ูุตูุฑ ุฌุฏุงู: {word_count} ูููุฉ (ุงููุทููุจ: 30+)"
    
    # 2. ุงูุชุญูู ูู ูุฌูุฏ CTA (Call To Action)
    cta_keywords = [
        'ุงุดุชุฑู', 'subscribe', 'ุงุดุชุฑุงู', 
        'ูุงูู', 'like', 'ุฅุนุฌุงุจ',
        'ุดุงุฑู', 'share', 'ูุดุงุฑูุฉ',
        'ุชุนููู', 'comment', 'ุฑุฃูู',
        'ุฌุฑุณ', 'bell', 'ุฅุดุนุงุฑุงุช',
        'ุชุงุจุน', 'follow', 'ูุชุงุจุนุฉ'
    ]
    
    script_lower = script.lower()
    found_ctas = []
    
    for keyword in cta_keywords:
        if keyword in script_lower:
            found_ctas.append(keyword)
    
    cta_count = len(found_ctas)
    
    print(f"   ๐ ูููุงุช ุงูุญุซ ุนูู ุงูุฅุฌุฑุงุก: {cta_count}")
    if found_ctas:
        print(f"   ๐ ุงููููุงุช ุงูููุฌูุฏุฉ: {', '.join(found_ctas[:3])}")
    
    if cta_count < 2:
        return False, f"ุนุฏุฏ ูููุงุช ุงูุญุซ ูููู: {cta_count} (ุงููุทููุจ: 2+)"
    
    # 3. ุงูุชุญูู ูู ุงูุชููุน ุงููุบูู
    unique_words = set(words)
    diversity_score = len(unique_words) / word_count if word_count > 0 else 0
    
    print(f"   ๐ฏ ุฏุฑุฌุฉ ุงูุชููุน: {diversity_score:.2%}")
    
    if diversity_score < 0.4:
        return False, f"ุชููุน ุงููููุงุช ุถุนูู: {diversity_score:.0%} (ุงููุทููุจ: 40%+)"
    
    # 4. ุงูุชุญูู ูู ุงูุฌูู ุงูุทูููุฉ (ุนูุงูุฉ ุนูู ุงููุญุชูู ุงูุฌูุฏ)
    sentences = [s.strip() for s in script.replace('!', '.').replace('?', '.').split('.') if s.strip()]
    avg_sentence_length = sum(len(s.split()) for s in sentences) / len(sentences) if sentences else 0
    
    print(f"   ๐ ูุชูุณุท ุทูู ุงูุฌููุฉ: {avg_sentence_length:.1f} ูููุฉ")
    
    if avg_sentence_length < 5:
        return False, f"ุงูุฌูู ูุตูุฑุฉ ุฌุฏุงู: {avg_sentence_length:.1f} (ุงููุทููุจ: 5+)"
    
    # 5. ุญุณุงุจ ุงูููุงุท ุงูููุงุฆูุฉ
    score = 0
    score += min(word_count / 50, 3)  # ุญุชู 3 ููุงุท ููุทูู
    score += min(cta_count / 2, 2)    # ุญุชู ููุทุชูู ููู CTA
    score += min(diversity_score * 10, 3)  # ุญุชู 3 ููุงุท ููุชููุน
    score += min(avg_sentence_length / 5, 2)  # ุญุชู ููุทุชูู ูุทูู ุงูุฌูู
    
    total_score = score
    max_score = 10
    
    print(f"   โญ ุงููุชูุฌุฉ ุงูุฅุฌูุงููุฉ: {total_score:.1f}/{max_score}")
    
    if total_score >= 6:
        return True, f"โ ูุฌุงุญ! ุงููุชูุฌุฉ: {total_score:.1f}/{max_score} - {word_count} ูููุฉุ {cta_count} ุญุซ ุนูู ุงูุฅุฌุฑุงุก"
    else:
        return False, f"โ ูุดู! ุงููุชูุฌุฉ: {total_score:.1f}/{max_score} (ุงููุทููุจ: 6+)"

if __name__ == "__main__":
    # ุงุฎุชุจุงุฑ ุงููุธููุฉ
    test_scripts = [
        "ุงุดุชุฑู ูููู ุงูููุฏูู",
        "ูุฑุญุจุงู ุจูู ูู ูุฐุง ุงูููุฏูู ุงูุชุนูููู ุงูุดุงูู ุงูุฐู ุณูู ูุณุชุนุฑุถ ููู ูู ุงูุชูุงุตูู ุงููููุฉ. ูุฑุฌู ูููู ุงูุงุดุชุฑุงู ูู ุงูููุงุฉ ูุชูุนูู ุงูุฌุฑุณ ููุงุทูุงุน ุนูู ูู ุฌุฏูุฏ. ุดุงุฑูููุง ุขุฑุงุกูู ูู ุงูุชุนูููุงุช.",
        "ุดูุฑุงู ูููุดุงูุฏุฉ"
    ]
    
    for i, script in enumerate(test_scripts, 1):
        print(f"\n๐ ุงุฎุชุจุงุฑ {i}:")
        result, message = quality_check(script)
        print(f"   ุงููุชูุฌุฉ: {result}")
        print(f"   ุงูุฑุณุงูุฉ: {message}")
EOF
          
          echo "โ quality_gate.py improved - Smart scoring system (6/10 required)"

      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      # 6. ุฅูุดุงุก ููู ุงูุฅุนุฏุงุฏุงุช ูุงูุจูุฆุฉ
      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      - name: โ๏ธ Create configuration files
        run: |
          echo "=== Creating configuration files ==="
          
          # ุฅูุดุงุก ููู .env
          cat > .env << 'EOF'
# ุฅุนุฏุงุฏุงุช ูุตูุน ููุชููุจ ุงูุขูู
PROJECT_NAME=Auto YouTube Factory
ENVIRONMENT=production
DEBUG=false

# ุฅุนุฏุงุฏุงุช YouTube API
GOOGLE_APPLICATION_CREDENTIALS=client_secret.json
YOUTUBE_API_VERSION=v3
UPLOAD_PRIVACY=private  # public, private, unlisted

# ุฅุนุฏุงุฏุงุช ุงูุฌูุฏุฉ
MIN_SCRIPT_WORDS=30
MIN_QUALITY_SCORE=6
REQUIRED_CTAS=2

# ุฅุนุฏุงุฏุงุช ุงูููุฏูู
VIDEO_RESOLUTION=1080p
VIDEO_FPS=30
VIDEO_DURATION_MAX=600  # 10 ุฏูุงุฆู
BACKGROUND_MUSIC=true
WATERMARK=true

# ุฅุนุฏุงุฏุงุช ุงูุฌุฏููุฉ
AUTO_RUN_INTERVAL=6  # ุณุงุนุงุช
MAX_VIDEOS_PER_DAY=4
EOF
          
          # ุฅูุดุงุก config.json
          cat > config.json << 'EOF'
{
  "project": {
    "name": "Auto YouTube Factory",
    "version": "2.0.0",
    "description": "ูุธุงู ุฃูุชููุงุชููู ูุฅูุดุงุก ููุดุฑ ููุฏูููุงุช ููุชููุจ"
  },
  "settings": {
    "quality": {
      "min_words": 30,
      "min_score": 6,
      "required_ctas": 2
    },
    "video": {
      "format": "mp4",
      "resolution": "1920x1080",
      "fps": 30,
      "max_duration": 600
    },
    "upload": {
      "privacy": "private",
      "category": 27,
      "tags": ["ุชุนููู", "ุชูููููุฌูุง", "ุจุฑูุฌุฉ"]
    },
    "schedule": {
      "enabled": true,
      "interval_hours": 6,
      "max_daily": 4
    }
  },
  "channels": {
    "main": "ุงูุชุนููู ุงูุชููู",
    "backup": "ุชุทููุฑ ุงูุฐุงุช",
    "niche": "ุงูุฐูุงุก ุงูุงุตุทูุงุนู"
  },
  "topics": [
    "ุงูุจุฑูุฌุฉ",
    "ุงูุฐูุงุก ุงูุงุตุทูุงุนู",
    "ุชุนูู ุงูุขูุฉ",
    "ุชุญููู ุงูุจูุงูุงุช",
    "ุงูุชุณููู ุงูุฑููู",
    "ุฑูุงุฏุฉ ุงูุฃุนูุงู",
    "ุงูุชุทููุฑ ุงูุดุฎุตู",
    "ุงูุนููู ุงูุญุฏูุซุฉ"
  ]
}
EOF
          
          # ุฅูุดุงุก ูุฌูุฏุงุช ุงูุชุฎุฒูู
          mkdir -p videos/images videos/audio videos/output
          mkdir -p logs/archive reports/weekly
          
          echo "โ Configuration files created"

      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      # 7. ุฅูุดุงุก ููู client_secret.json ูู ุงูู Secret
      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      - name: ๐ Create Google API credentials
        env:
          GOOGLE_CLIENT_SECRET: ${{ secrets.GOOGLE_CLIENT_SECRET }}
        run: |
          echo "=== Creating Google API credentials ==="
          
          if [ -z "$GOOGLE_CLIENT_SECRET" ]; then
            echo "โ ERROR: GOOGLE_CLIENT_SECRET is empty!"
            echo "Please add your Google API credentials to GitHub Secrets"
            echo ""
            echo "Steps to fix:"
            echo "1. Go to Repository โ Settings โ Secrets and variables โ Actions"
            echo "2. Click 'New repository secret'"
            echo "3. Name: GOOGLE_CLIENT_SECRET"
            echo "4. Paste your client_secret.json content"
            echo "5. Click 'Add secret'"
            exit 1
          fi
          
          # ุญูุธ ุงูู secret ูู ููู
          echo "$GOOGLE_CLIENT_SECRET" > client_secret.json
          
          # ุงูุชุญูู ูู ุตุญุฉ JSON
          python -c "
import json
try:
    with open('client_secret.json', 'r') as f:
        data = json.load(f)
    print(f'โ Valid JSON file created')
    print(f'   Project: {data.get(\"installed\", {}).get(\"project_id\", \"Unknown\")}')
    print(f'   Client ID: {data.get(\"installed\", {}).get(\"client_id\", \"Unknown\")[:30]}...')
except json.JSONDecodeError as e:
    print(f'โ Invalid JSON: {e}')
    exit(1)
except Exception as e:
    print(f'โ Error: {e}')
"
          
          echo "โ Google API credentials configured"

      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      # 8. ุงุฎุชุจุงุฑ ุฌููุน ุงูููููุงุช ูุจู ุงูุชุดุบูู
      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      - name: ๐งช Test all components
        run: |
          cd /home/runner/work/auto-youtube-factory/auto-youtube-factory
          
          echo "=== Testing all system components ==="
          
          python -c "
import sys
sys.path.insert(0, '.')

print('๐ง ุงููุธุงู ูุนูู ุนูู:', sys.platform)
print('๐ ุฅุตุฏุงุฑ Python:', sys.version.split()[0])
print('')

# ุงุฎุชุจุงุฑ ูู agent
agents = [
    ('agents.trend_agent', 'get_trend'),
    ('agents.profit_agent', 'profit_score'),
    ('agents.script_agent', 'generate_script'),
    ('agents.halal_guard', 'halal_check'),
    ('agents.quality_gate', 'quality_check'),
    ('agents.video_agent', 'create_video'),
    ('agents.upload_agent', 'upload'),
    ('agents.analytics_agent', 'get_stats'),
    ('agents.memory_agent', 'remember'),
    ('agents.recycle_agent', 'add_short'),
    ('agents.ceo_agent', 'review'),
    ('utils.emailer', 'send_email')
]

all_passed = True
for module_name, func_name in agents:
    try:
        module = __import__(module_name, fromlist=[''])
        if hasattr(module, func_name):
            print(f'โ {module_name}.{func_name}()')
        else:
            print(f'โ๏ธ  {module_name} (no {func_name})')
            all_passed = False
    except ImportError as e:
        print(f'โ {module_name}: {e}')
        all_passed = False

print('')
if all_passed:
    print('๐ ุฌููุน ุงูููููุงุช ุฌุงูุฒุฉ ููุชุดุบูู!')
else:
    print('โ๏ธ  ุจุนุถ ุงูููููุงุช ุชุญุชุงุฌ ุฅุตูุงุญ')
    
# ุงุฎุชุจุงุฑ ุชูููุฏ ุณูุฑูุจุช
print('\\n๐ ุงุฎุชุจุงุฑ ุชูููุฏ ุงูุณูุฑูุจุช:')
try:
    from agents.script_agent import generate_script
    script = generate_script('ุงูุชุนูู ุงูุขูู')
    words = len(script.split())
    print(f'   โ ุชู ุชูููุฏ ุณูุฑูุจุช ุจู {words} ูููุฉ')
    
    from agents.quality_gate import quality_check
    ok, msg = quality_check(script)
    print(f'   ๐ ูุญุต ุงูุฌูุฏุฉ: {ok} - {msg}')
except Exception as e:
    print(f'   โ ุฎุทุฃ: {e}')
"

      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      # 9. ุชุดุบูู ูุตูุน ุงูููุชููุจ ุงูุขูู
      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      - name: ๐ Run YouTube automation factory
        timeout-minutes: 30  # ููุช ุฃูุตู ููุชุดุบูู
        run: |
          cd /home/runner/work/auto-youtube-factory/auto-youtube-factory
          
          echo "========================================="
          echo "๐ ุชุดุบูู ูุตูุน ุงูููุชููุจ ุงูุขูู"
          echo "========================================="
          echo "โฐ ุงูููุช: $(date)"
          echo "๐ ุงููุฌูุฏ: $(pwd)"
          echo "๐ Python: $(python --version)"
          echo "========================================="
          
          # ุชุดุบูู Supervisor ูุน ุชุณุฌูู ุงููุชุงุฆุฌ
          python -m agents.supervisor 2>&1 | tee production.log
          
          EXIT_CODE=$?
          
          echo ""
          echo "========================================="
          echo "๐ ุงูุชูู ุงูุชุดุบูู - ุงููุชุงุฆุฌ"
          echo "========================================="
          
          if [ $EXIT_CODE -eq 0 ]; then
            echo "๐ **ุงููุฌุงุญ ุงููุงูู!**"
            echo "โ ุชู ุฅูุดุงุก ุงูููุฏูู ูุชุญูููู ุจูุฌุงุญ"
            echo "โ ุชู ุฅุฑุณุงู ุงูุชูุงุฑูุฑ"
            echo "โ ุงููุธุงู ูุนูู ุจุดูู ูุซุงูู"
          else
            echo "โ๏ธ  **ุงูุชูู ูุน ุฃุฎุทุงุก**"
            echo "ุฑูุฒ ุงูุฎุฑูุฌ: $EXIT_CODE"
            echo ""
            echo "๐ **ุขุฎุฑ 10 ุฃุณุทุฑ ูู ุงูู log:**"
            tail -10 production.log
          fi
          
          # ุนุฑุถ ููุฎุต ุงูุชูููุฐ
          echo ""
          echo "๐ **ููุฎุต ุงูุชูููุฐ:**"
          grep -i "uploaded\|sent\|created\|failed\|error\|success" production.log | head -10 || echo "ูุง ุชูุฌุฏ ุฑุณุงุฆู ููุฎุตุฉ"
          
          exit $EXIT_CODE

      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      # 10. ุฌูุน ูุชุญููู ุงููุชุงุฆุฌ
      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโู
      - name: ๐ค Upload results and artifacts
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: youtube-production-results
          path: |
            production.log
            videos/
            logs/
            *.json
            *.env
          retention-days: 30

      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      # 11. ุชูุฑูุฑ ุงููุชุงุฆุฌ ุงูููุงุฆู
      # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
      - name: ๐ Final report
        if: always()
        run: |
          echo "========================================="
          echo "๐ ุชูุฑูุฑ ุชุดุบูู ูุตูุน ุงูููุชููุจ"
          echo "========================================="
          echo "๐ข ุฑูู ุงูุชุดุบูู: ${{ github.run_number }}"
          echo "๐ค ุงูููุดุบูู: ${{ github.actor }}"
          echo "โฐ ูุฏุฉ ุงูุชุดุบูู: ${{ job.status }}"
          echo ""
          
          if [ -f "production.log" ]; then
            echo "๐ **ุขุฎุฑ ุงููุชุงุฆุฌ:**"
            grep -E "(Uploaded|sent:|created:|failed:|Error:|Success:)" production.log | tail -5 || echo "ูุง ุชูุฌุฏ ูุชุงุฆุฌ ูุณุฌูุฉ"
          fi
          
          echo ""
          echo "โ **ุงูููุงู ุงูููุชููุฉ:**"
          echo "   โ ุชุซุจูุช Python ูุงูููุชุจุงุช"
          echo "   โ ุชุญุณูู ูููุฏ ุงููุตูุต"
          echo "   โ ุชุญุณูู ุจูุงุจุฉ ุงูุฌูุฏุฉ"
          echo "   โ ุฅูุดุงุก ูููุงุช ุงูุฅุนุฏุงุฏุงุช"
          echo "   โ ุชูููู Google API"
          echo "   โ ุงุฎุชุจุงุฑ ุฌููุน ุงูููููุงุช"
          echo "   โ ุชุดุบูู ุงููุตูุน ุงูุขูู"
          echo ""
          
          if [ "${{ job.status }}" = "success" ]; then
            echo "๐ **ุงูุชุดุบูู ุงููุงุฌุญ!**"
            echo "   ุชู ุฅูุดุงุก ููุฏูู ุฌุฏูุฏ ุนูู ุงูููุชููุจ"
            echo "   ููููู ุชูุฒูู ุงููุชุงุฆุฌ ูู ูุณู Artifacts"
          else
            echo "โ๏ธ  **ููุงู ูุดููุฉ ุชุญุชุงุฌ ูุฑุงุฌุนุฉ**"
            echo "   ุฑุงุฌุน ุงูู logs ูุงูุชุดุงู ุงููุดููุฉ"
          fi
          
          echo "========================================="
